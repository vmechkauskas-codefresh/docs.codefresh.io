<form class="bd-search d-flex align-items-center">
  <input type="search" class="form-control" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
  <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3" type="button" data-toggle="collapse" data-target="#bd-docs-nav" aria-controls="bd-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation">
    {%- include icons/menu.svg width="30" height="30" -%}
  </button>
</form>

<nav class="collapse bd-links" id="bd-docs-nav">
  {%- assign page_url = page.url | split: '/' -%}

  {% if page_url.size == 6 %}
    {%- assign page_slug_index = page_url.size | minus: 2 -%}
    {%- assign page_slug = page_url[page_slug_index] -%}
    {%- assign sub_page_slug = page_url | last -%}
  {% else %}
    {%- assign page_slug = page_url | last -%}
  {% endif %}

  <!--
  page_slug_index: {{ page_slug_index }}
  page_slug: {{ page_slug }}
  sub_page_slug: {{ sub_page_slug }}
  -->

  {%- for navItem in site.data.nav -%}

    {% if navItem.url %}
      {%- assign group_slug = navItem.url | slugify -%}
    {% else %}
      {%- assign group_slug = navItem.title | slugify -%}
    {% endif %}

    {%- assign link = navItem.pages | first -%}

    {% if link.url %}
      {%- assign link_slug = link.url | slugify -%}
    {% else %}
      {%- assign link_slug = link.title | slugify -%}
    {% endif %}

    {%- assign active = nil -%}
    <!--
      page.group: {{ page.group }}
      group_slug: {{ group_slug }}
    -->
    {%- if page.group == group_slug -%}
      {%- assign active = 'active' -%}
    {%- endif -%}

    <div class="bd-toc-item{% unless active == nil %} {{ active }}{% endunless %}">
      <!-- first lvl - group -->
      <a class="bd-toc-link text-uppercase" href="{{ site.baseurl }}/docs/{{ site.docs_version }}/{{ group_slug }}/{{ link_slug }}{% if link_slug %}/{% endif %}">
        {{ navItem.title }}
      </a>
      <!-- 2nd lvl menu -->
      <ul class="nav bd-sidenav">
        {%- for doc in navItem.pages -%}

          {% if doc.url %}
            {%- assign doc_slug = doc.url | slugify -%}
          {% else %}
            {%- assign doc_slug = doc.title | slugify -%}
          {% endif %}

          {%- assign active = nil -%}

          {%- if page.group == group_slug and page_slug == doc_slug -%}
            {%- assign active = 'active bd-sidenav-active' -%}
          {%- endif -%}
          <!-- 2nd lvl menu item -->
          <li{% unless active == nil %} class="{{ active }}"{% endunless %}>
            <a href="{{ site.baseurl }}/docs/{{ site.docs_version }}/{{ group_slug }}/{{ doc_slug }}/" data-doc-slug="{{ doc_slug }}">
              {{ doc.title }}
            </a>

            <!--3rd lvl menu -->
            {% unless doc.sub-pages == nil %}
              <ul class="nav bd-sidenav">
                {%- for subdoc in doc.sub-pages -%}

                  {% if subdoc.url %}
                    {%- assign sub_doc_slug = subdoc.url | slugify -%}
                  {% else %}
                    {%- assign sub_doc_slug = subdoc.title | slugify -%}
                  {% endif %}

                  {%- assign sub_active = nil -%}

                  <!--
                    page.sub_group: {{ page.sub_group }}
                    group_slug: {{ group_slug }}
                    doc_slug: {{ doc_slug }}
                    sub_page_slug: {{ sub_page_slug }}
                    sub_doc_slug: {{ sub_doc_slug }}
                  -->

                  {%- if page.sub_group == doc_slug and sub_page_slug == sub_doc_slug -%}
                    {%- assign sub_active = 'active bd-sidenav-active' -%}
                  {%- endif -%}

                  <li{% unless sub_active == nil %} class="{{ sub_active }}"{% endunless %}>
                    <a href="{{ site.baseurl }}/docs/{{ site.docs_version }}/{{ group_slug }}/{{ doc_slug }}/{{ sub_doc_slug }}/">
                      {{ subdoc.title }}
                    </a>
                  </li>

                {%- endfor -%}
              </ul>
            {% endunless %}
            <!--/-->

            {%- comment -%}

            {% unless doc.sub-pages == nil %}
              <ul class="nav">
                {% for section in doc.sections %}
                  <li>
                    <a href="#{{ section.title | downcase | replace: ' ', '-' }}">
                      {{ section.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endunless %}

            {%- endcomment -%}

          </li>
        {%- endfor -%}
      </ul>
    </div>
  {%- endfor -%}
</nav>
